# Операционные системы UNIX/Linux (Базовый).

##### Установить **Ubuntu 20.04 Server LTS** без графического интерфейса. (Используем программу для виртуализации - VirtualBox)

- Графический интерфейс должен отсутствовать.

- Узнайте версию Ubuntu, выполнив команду \
`cat /etc/issue.`

-  Скрин с рамкой виртуал бокса и версией убунту

![linux_wer](src/images/s_1.png)

## Part 2. Создание пользователя

##### Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу `adm`.

- Создание нового пользователя ``sudo useradd -G adm user2``
![linux_wer](src/images/s_2.png)

- Задаем пароль нового пользователя ``sudo passwd new_user``

- Просмотр нового пользователя ``cat /etc/passwd``

![linux_wer](src/images/s_3.png)

## Part 3. Настройка сети ОС

##### Задать название машины вида user-1  
``sudo nano /etc/hostname``  - меняем через нано

![linux_wer](src/images/s_4.png)

##### Установить временную зону, соответствующую вашему текущему местоположению.  

- Изменил часовую зону  ``sudo timedatectl set-timezone Europe/Moscow``
    
![linux_wer](src/images/s_5.png)   

- Проверил изменнения ``sudo timedatectl show-timesync``

![linux_wer](src/images/s_6.png)   

##### Вывести названия сетевых интерфейсов с помощью консольной команды.

- Просмотрел сетевые интефейсы - ``ifconfig -a``
- Не было инсрументов, поставил нет пакет ``sudo apt install net-tools``
- Просмотрел сетевые интефейсы - ``ifconfig -a``

![linux_wer](src/images/s_7.png) 

- Интерфейс "lo" (loopback) в системе Linux Ubuntu представляет собой виртуальный сетевой интерфейс, который используется для локальной обратной связи. Он является встроенной частью ядра Linux и обеспечивает возможность взаимодействия сетевых приложений на локальном уровне.

- Интерфейс "lo" позволяет приложениям обмениваться сетевыми пакетами, как если бы они были отправлены и получены через физические сетевые интерфейсы. Однако вместо отправки и получения пакетов через физические сетевые адаптеры, пакеты, отправленные через интерфейс "lo", остаются внутри операционной системы и доставляются обратно тому же приложению или службе.

- Интерфейс "lo" обычно имеет IP-адрес 127.0.0.1 (также называемый "адресом циклической обратной связи") и маску подсети 255.0.0.0. Этот IP-адрес используется для доступа к самому компьютеру через интерфейс "lo". Приложения могут использовать этот адрес для установления соединения с другими приложениями на том же компьютере.

- Интерфейс "lo" особенно полезен при разработке и отладке сетевых приложений, когда требуется тестирование взаимодействия между клиентом и сервером на одной машине. Также он может быть использован для настройки локальных сетевых служб, таких как DNS-серверы, веб-серверы и другие.

##### Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера. 
``ip addr show``
 - где внешний айпи указан наиже
 - тут был ребут машны и название сменилось

![linux_wer](src/images/s_8.png) 

- DHCP (Dynamic Host Configuration Protocol) сервер - это сетевой сервер, который автоматически назначает IP-адреса и другие сетевые параметры клиентским устройствам в компьютерной сети. DHCP сервер является частью протокола DHCP, который позволяет устройствам получать настройки сети, такие как IP-адрес, маска подсети, адрес шлюза по умолчанию и адреса DNS серверов, без необходимости вручную настраивать каждое устройство.

- При подключении устройства к сети, оно отправляет DHCP-запрос на броадкаст адрес (255.255.255.255) с просьбой получить IP-адрес. DHCP сервер в сети получает этот запрос и предоставляет устройству доступный IP-адрес, который ранее был назначен DHCP сервером. Таким образом, DHCP сервер обеспечивает автоматическую настройку сетевых параметров для клиентских устройств, упрощая процесс установки и настройки сети.

- DHCP сервер может быть настроен на центральном сервере или на маршрутизаторе в сети. Он играет важную роль в сетевых окружениях, где требуется быстрое и автоматическое назначение IP-адресов, особенно в сетях с большим количеством устройств, таких как офисные сети или общественные Wi-Fi сети.

-  Сбрасываем свой старый ip адрес командой `sudo dhclient -r enp0s3`

![linux_wer](src/images/s_10.png) 

- И получаем новый командой `sudo dhclient -v enp0s3`

- Проверить все это можно командой `ifconfig`

![linux_wer](src/images/s_11.png) 

##### Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 

- Узнаем свой внешний ip address командой `wget -O - -q icanhazip.com`

![linux_wer](src/images/s_9.png) 

- Узнаем внутренний ip командой `route -n`

![linux_wer](src/images/s_12.png) 

##### Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).  

- ``sudo nano /etc/netplan/00-installer-config.yaml`` - в этом файле уже имеется шаблон для нашей сети enp0s3. Наша задача - отключить получение адресов от DHCP и присвоить свой статический адрес.

-  ``dhcp4: true`` меняем на ``dhcp4: false`` и ниже добавляем строки с выбранным нами IP, шлюзом и DNS-серверами

![linux_wer](src/images/1.png) 

- смотрим наш шлюз командой ``route -n``, в этом диапазоне адресов задаём IP

![linux_wer](src/images/2.png) 

- задаём IP, а в качестве DNS выбираем гугловские 1.1.1.1 и 8.8.8.8, как рекомендуется в задании

![linux_wer](src/images/3.png) 

-  `sudo netplan apply` - для применения конфигураций

-  `sudo netplan try` - для применения изменений

- `ifconfig` - проверяем

![linux_wer](src/images/4.png) 

##### Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.  

``sudo reboot `` - перезагружаем машину 

- нужно пропинговать удаленные хосты 1.1.1.1 и ya.ru 
 - в выводе команды должна быть фраза "0% packet loss".

`ping ya.ru` - проверяем работу

![linux_wer](src/images/5.png) 

`ping 1.1.1.1` - проверяем работу

![linux_wer](src/images/6.png) 

## Part 4. Обновление ОС

##### Обновить системные пакеты до последней на момент выполнения задания версии.  

`sudo apt update` - команда обновления системы

`sudo apt dist-upgrade` - обновляю версию пакетов

- После обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют.
- скриншот с этим сообщением

![linux_wer](src/images/7.png) 

## Part 5. Использование команды **sudo**

- Команда sudo - позволяет строго определенным пользователям выполнять указанные программы с административными привилегиями без ввода пароля суперпользователя root

- чтобы разрешить пользователю, созданному ранее выполнять команду sudo, создаем файл для пользователя `sudo touch /etc/sudoers.d/user2`
- `sudo nano /etc/sudoers.d/user2` - открываем в nano 
- записывем строку user2 ALL=(ALL:ALL) ALL 
- (или можно через добавление в группу, узанл позже)

![linux_wer](src/images/8.png) 

- перехожу к другому юзеру командой ``su user2``
- для проверки прав вводим `sudo apt update`

![linux_wer](src/images/9.png) 

- судо права доступны, вводим `sudo nano /etc/hostname` смепнил на host

- перезагружаем систему - проверить смену хоста  `sudo reboot`

- скрин с изменённым hostname 

![linux_wer](src/images/10.png) 

## Part 6. Установка и настройка службы времени

-  `sudo apt install -y ntp` - устанавливаем

-  `dpkg -l | grep "ntp"` - проверяем все ли установилось успешно

-  `sudo apt update` - снова обновляем чтобы проверить все ли нормально

-  `ntpq -p` - Проверим, что `ntp` подключён к серверам времен

![linux_wer](src/images/11.png) 

-  `sudo systemctl stop ntp` - остановим нашу команду

-  `sudo ntpd -gq` - и принудительно синхронизируем все это

-  `sudo systemctl start ntp` - снова все запускаем

![linux_wer](src/images/12.png) 

-  `sudo apt install systemd-timesyncd` - ставим утилиту для синхронизации времени

-  `timedatectl set-ntp true` - синхронизируем

- `timedatectl show` - и в конце проверяем

![linux_wer](src/images/14.png) 

## Part 7. Установка и использование текстовых редакторов 

##### Установить текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  

##JOE

-  `sudo apt install joe` - скачиваю `Joe` текстовый редактор.
- у нас уже установлены два редактора это vim и nano

![linux_wer](src/images/15.png) 

-  `sudo Joe test_JOE.txt` - создаю .txt файл и открываю его для записи
- pаписал все что мне нужно

![linux_wer](src/images/16.png) 

-  `control+k` а потом нажимаю `Q` и он спросит сохранить изменения нажимаю кнопку `y` и он все сохранит и выйдет  `n` выход без сохранения

![linux_wer](src/images/17.png) 

- Снова открывю файл и меняю содержимое на `21 School 21`, но уже без сохраниния

![linux_wer](src/images/18.png) 

- Для поиска я нажимаю `control+k` и потом `f` 
- пишу исомое слово и `enter`

![linux_wer](src/images/19.png) 

- нам показывают еще несколько команд, из них нам понадобиться только `R`
- и слово на которое мы заменим в моем случае это `knapptan`

![linux_wer](src/images/20.png) 

- выходим

##VIM

- `sudo vim test_VIM.txt` - создаю `.txt` файл и открываю его для записи

![linux_wer](src/images/21.png) 

- нажимаю `i` для перехода в режим ввода

![linux_wer](src/images/22.png) 

- пишу свой ник

- нажимаю `escape`

- для выхода пишу `:wq` w для сохранения файла 

![linux_wer](src/images/23.png) 

`sudo vim test_VIM.txt` - открываю файл заново для записи

- нажимаю `i` для перехода в режим ввода

- меняю `knapptan` на `21 School 21`

- для выхода пишу `:q!` ! для игнорирования сообщений от вим  

![linux_wer](src/images/24.png) 

-проверяю что не поменялся `cat имя файла` 

![linux_wer](src/images/25.png) 

`sudo vim test_VIM.txt` - открываю файл заново для записи

`escape` и ввести `:s/искомое слово/слово на которую мы заменим/g` - этот флаг отвечает за то чтобы во всем текстовом файле искомое слово было заменено

![linux_wer](src/images/26.png) 

- сохраняем и выходим, проверяем

![linux_wer](src/images/27.png) 

##NANO

- `sudo nano test_NANO.txt` - создаю `.txt` файл и открываю его для записи

![linux_wer](src/images/28.png)

- записываю. Нажимаю команду `control+x` меня спрашивают сохранить изменения?  
пишу `y` и нажимаю кнопку `enter`

![linux_wer](src/images/29.png)

- аналогично открываю, изменяю, `control+x`, n.

![linux_wer](src/images/30.png)

- для того чтобы он произвел поиск и замену текста мы нажимаем `control+\`

![linux_wer](src/images/31.png)

- вводим слово для поиска и энетер затем слово на которое меняем и затем меняем или одно или все

![linux_wer](src/images/32.png)

## Part 8. Установка и базовая настройка сервиса **SSHD**

-  устанавливаем SSH-сервер в системе, команда: `sudo apt-get install openssh-server`

![linux_wer](src/images/33.png)

- для включения автостарта службы воспользуемся командой: `sudo systemctl enable ssh`

![linux_wer](src/images/34.png)

- перенастроить службу SSHd на порт 2022 - для этого открыл файл конфигурации с помощью команды: `sudo vim /etc/ssh/ssh_config `

![linux_wer](src/images/35.png)

- сменил номер порта на 2022 с 22

![linux_wer](src/images/36.png)

- перезапустил командой `sudo service ssh restart` и проверю командой `sudo service sshd status` - не поменялось 

- перезапустил систему `reboot`

- ничео не изменилось, меняю sshd конфиг на 2022 порт  `sudo vim /etc/ssh/sshd_config `

![linux_wer](src/images/37.png)

- перезапустил командой `sudo service ssh restart` и проверю командой `sudo service sshd status` - все изменилось

![linux_wer](src/images/38.png)

##### Используя команду ps, показать наличие процесса sshd.

- ps (от англ. process status) — программа в Unix-подобных операционных системах, выводящая отчёт о работающих процессах. Ключ -А (-е) позволяет вывести все процессы.

![linux_wer](src/images/39.png)

- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \

![linux_wer](src/images/40.png)

netstat (network statistics) — утилита командной строки, выводящая на дисплей состояние TCP-соединений (как входящих, так и исходящих), таблицы маршрутизации, число сетевых интерфейсов и сетевую статистику по протоколам. Основное назначение утилиты — поиск сетевых проблем и определение производительности сети.

Используемые ключи:
t (--tcp) - показывать только TCP порты.
a (--all) - показывать состояние всех сокетов.
-n (--numeric) - показывать сетевые адреса как числа (например 127.0.0.53:53 вместо localhost:domain)
Значения столбцов
Proto - протокол, используемый сокетом. Так как была использована опция [-t|--tcp], в выводе пристутвуют только TCP-сокеты.
Recv-Q - счётчик байт, не скопированных программой пользователя из этого сокета.
Send-Q - счётчик байтов, не подтверждённых удалённым узлом.
Local Address - адрес и номер порта локального конца сокета. Если указана опция [-n|--numeric], вывод в формате [адрес сокета:номер порта], иначе - [каноническое имя узла:соответствующее имя службы]. В интересующей нас строчке 0.0.0.0 - адрес локального конца сокета, 2022 - номер порта, который мы поменяли с 22 на 2022. Адрес 0.0.0.0 означает, что удаленный конец сокета будет доступен всем локальным ip-адресам.
Foreign Address - адрес и номер порта удалённого конца сокета.
State - состояние сокета. Состояние LISTEN означает, что сокет ожидает входящих подключений.

## Part 9. Установка и использование утилит **top**, **htop**

##### Установить и запустить утилиты top и htop.  

- установка `sudo apt install top/htop` информация о состоянии системы из выовода утилиты top

- взываем команду `top`

![linux_wer](src/images/41.png)

* uptime - 29 min
* количество авторизованных пользователей - 1
* общую загрузку системы(load avarage) - 0.00, 0.00, 0.00
* общее количество процессов(Tasks) - 103 total, 1 running, 102 sleeping, 0 stopped, 0 zombie
* загрузку cpu - 0,0 us, 0,2 su, 0,0 ni, 99,8 id, 0,0 wa, 0,0 hi, 0,0 si, 0,0 st
* загрузку памяти (Mib Mem) - 3042,2 total, 2468,6 free, 159,9 used, 413.6 buff/cache
* pid процесса занимающего больше всего памяти - 689
* pid процесса, занимающего больше всего процессорного времени - 1

- взываем команду `htop`

![linux_wer](src/images/42.png)

- для сортировки по какому-либо параметру жмем `F6` после выбираем парметр 

![linux_wer](src/images/43.png)

- сортировка по `PID`

![linux_wer](src/images/44.png)

- сортировка по `PERCENT_CPU`

![linux_wer](src/images/45.png)

- сортировка по `TIME` 

![linux_wer](src/images/46.png)

- для фильтрации по какому-либо параметру жмем `F4` после выбираем парметр 

- отфлиртованный процесс `sshd`

![linux_wer](src/images/47.png)

- поиск процесса  `syslog` жмем `F3` и вводим  

![linux_wer](src/images/48.png)

- с добавленным выводом hostname, clock и uptime
- настариваю добавление 

![linux_wer](src/images/49.png)

- вывод

![linux_wer](src/images/50.png)

## Part 10. Использование утилиты **fdisk**

##### Запустить команду fdisk -l.

- запускаю под судо  `sudo fdisk -l`

![linux_wer](src/images/51.png)

- Имя /dev/sda
- Размер 25 Гб
- Колличество секторов 52428800
- Размер swap 2.2 Гб
- Узнать размер swap можно с помощью команды `free -h`

![linux_wer](src/images/52.png)

## Part 11. Использование утилиты **df** 

##### Запустить команду df.  

![linux_wer](src/images/53.png)

 - для корневого раздела `/`:
  - размер раздела 11758760
  - размер занятого пространства 4946164
  - размер свободного пространства 6193488
  - процент использования 45
- Определить и написать в отчёт единицу измерения в выводе. Kb 

##### Запустить команду df -Th.

![linux_wer](src/images/54.png)

- для корневого раздела  `/`:
    - размер раздела 12 G
    - размер занятого пространства 4.8 G
    - размер свободного пространства 6G
    - процент использования 45%
- Определить и написать в отчёт тип файловой системы для раздела etx 4 

## Part 12. Использование утилиты **du**

##### Запустить команду du.

![linux_wer](src/images/55.png)

##### Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)

`sudo du -B1 -d0 /home /var /var/log`

![linux_wer](src/images/56.png)

`sudo du -h -d0 /home /var /var/log`

![linux_wer](src/images/57.png)

##### Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

`sudo du -h -d0 /var/log/*`

![linux_wer](src/images/58.png)

## Part 13. Установка и использование утилиты **ncdu**

##### Установить утилиту ncdu.

`sudo apt install ncdu`

![linux_wer](src/images/59.png)

##### Вывести размер папок /home, /var, /var/log.

`sudo ncdu /home`

![linux_wer](src/images/60.png)

`sudo ncdu /var`

![linux_wer](src/images/61.png)

`sudo ncdu /var/log`

![linux_wer](src/images/62.png)


## Part 14. Работа с системными журналами

#### Открыть для просмотра:
##### 1. /var/log/dmesg

- содержит информацию о драйверах устройств

`sudo nano /var/log/dmesg`

![linux_wer](src/images/63.png)

##### 2. /var/log/syslog

- информация об авторизации пользователей, включая удачные и неудачные попытки входа в систему, а также задействованные механизмы аутентификации.

`sudo nano /var/log/syslog`

![linux_wer](src/images/64.png)

##### 3. /var/log/auth.log  

- глобальный системный журнал, в котором пишутся сообщения от ядра Linux, различных служб, сетевых интерфейсов и т.д. с момента запуска системы.

`sudo nano /var/log/auth.log`

![linux_wer](src/images/65.png)

- Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему.

Информация об авторизации: `sudo cat /var/log/auth.log | grep login`

![linux_wer](src/images/66.png)

- Перезапустить службу SSHd.

`sudo service ssh restart`

`sudo cat /var/log/syslog | grep ssh`

![linux_wer](src/images/67.png)

## Part 15. Использование планировщика заданий **CRON**

##### Используя планировщик заданий, запустите команду uptime через каждые 2 минуты.
- `sudo apt install cron`
- для создания задачи я открыл файл планировщик командой `crontab -e`

![linux_wer](src/images/68.png)

![linux_wer](src/images/69.png)

- Вывести на экран список текущих заданий для CRON.

![linux_wer](src/images/70.png)

- Вставить в отчёт скрины со строчками о выполнении и списком текущих задач.

![linux_wer](src/images/71.png)

##### Удалите все задания из планировщика заданий.

- `contrab -r`

![linux_wer](src/images/72.png)
